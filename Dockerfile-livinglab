# Dockerfile-livinglab

# Basis-Image
FROM node:18-alpine

# Installiere PM2
RUN npm install -g pm2

# Setze das Arbeitsverzeichnis
WORKDIR /app

# Kopiere package.json und package-lock.json für Frontend
COPY livinglabdashboard/package*.json ./frontend/

# Setze NPM-Registry auf das Standard-Registry, um lokale Registry-Probleme zu vermeiden
RUN npm config set registry https://registry.npmjs.org

# Installiere Abhängigkeiten für Frontend
RUN cd frontend && npm install --registry=https://registry.npmjs.org

# Kopiere den gesamten Frontend-Code
COPY livinglabdashboard/ ./frontend/

# Führe den Build-Prozess aus
RUN cd frontend && npx nuxt build

# Kopiere die PM2-Konfigurationsdatei
COPY ecosystem.config.js ./ecosystem.config.js

# Exponiere die benötigten Ports
EXPOSE 3001

# Starte PM2, um sowohl Frontend als auch Backend zu starten
CMD ["pm2-runtime", "ecosystem.config.js"]
